{% extends "layout.html" %}

{% block main %}
<div class="flex" id="screen-panel">
    <div class="w-1/8 h-screen items-center justify-center text-center" id="left-panel">
        <div class="h-1/2 text-wrap justify-center flex" id="volume-panel">
            <table class="text-center table-fixed w-full">
                <thead>
                    <tr class="h-12">
                        <th class="w-4/9">Ticker</th>
                        <th class="w-4/9">Volume</th>
                        <th class="w-1/9"></th>
                    </tr>
                </thead>
                <tbody>

                    {% for item in volumeData %}
                        <tr class="border-y border-solid border-collapse border-slate-400 bg-slate-600 hover:bg-slate-700 stock-item">
                            <td class="ticker-code cursor-pointer">
                                {{ item.ticker }}
                            </td>
                            <td>
                                {{ item.volume }}
                            </td>
                            <td>
                                <input type="hidden" name="q" value="{{ item.ticker }}">
                                <form class="fav-form" action="/favourite" method="get">
                                    
                                            
                                    <svg class="hover:fill-slate-200 cursor-pointer add_favourite stock-list-item" fill="#475569" height="20px" width="20px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 455 455" xml:space="preserve"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <polygon points="455,212.5 242.5,212.5 242.5,0 212.5,0 212.5,212.5 0,212.5 0,242.5 212.5,242.5 212.5,455 242.5,455 242.5,242.5 455,242.5 "></polygon> </g></svg> 
                              
                                </form>
                            </td>
                        </tr>
                        
                    {% endfor %}
                </tbody>
            </table>
        </div>
    
        <div class="h-1/2" id="favourites">
            <table class="text-center table-fixed w-full">
                <thead>
                    <tr class="h-12">
                        <th class="w-4/9">Ticker</th>
                        <th class="w-4/9">7 Day</th>
                        <th class="w-1/9"></th>
                    </tr>
                </thead>

                <tbody id="favourite-list">
                    {% for item in favouritesList %}
                    <tr class="border-y h-10 border-solid border-collapse border-slate-400 bg-slate-600 hover:bg-slate-700 stock-item">
                        <td class="ticker-code cursor-pointer">
                            {{ item.ticker }}
                        </td>
                        <td class="flex align-middle justify-evenly">
                            {% if item.change > 0 %}
                                <svg class="block" width="20px" height="20px" viewBox="0 0 16.00 16.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0)matrix(1, 0, 0, 1, 0, 0)" stroke="#0ea5e9"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round" stroke="#0ea5e9" stroke-width="0.032"></g><g> <path d="M6 8L2 8L2 6L8 5.24536e-07L14 6L14 8L10 8L10 16L6 16L6 8Z" fill="#0ea5e9"></path> </g></svg>
                            {% else %}
                                <svg class="block" width="20px" height="20px" viewBox="0 0 16.00 16.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0)matrix(1, 0, 0, -1, 0, 0)" stroke="#ec4899"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round" stroke="#ec4899" stroke-width="0.032"></g><g> <path d="M6 8L2 8L2 6L8 5.24536e-07L14 6L14 8L10 8L10 16L6 16L6 8Z" fill="#ec4899"></path> </g></svg>
                            {% endif %}

                           <p class="block h-full">{{item.change}} %</p> 
                        </td>
                        <td>
                            <input type="hidden" name="q" value="{{ item.ticker }}">
                            <form class="fav-form" action="/favourite" method="get">
                                
                                <svg class="cursor-pointer remove_favourite" width="20px" height="20px" viewBox="0 0 24 24" fill="" xmlns="http://www.w3.org/2000/svg"><g> <path class="hover:stroke-slate-200" d="M6 12L18 12" stroke="#475569" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>
    
    <div class="w-5/8 text-center h-fit" id="main-panel">

        <div class="size-full" id="main-panel-center">
            <div class="w-full h-12 bg-slate-500 flex justify-evenly relative" id="chart-search-panel">
                <input type="search" class="border-slate-950 border-solid rounded-md border my-1 text-center" autofocus id="search" placeholder="Search code">
                <div class="bg-slate-300 w-2/8 h-auto absolute z-10 top-full" id="search-container">
                    
                    <ul id="search-results">
                        <!-- search results go here -->
                    </ul>
                </div>
            </div>

            <div class="h-5/8 w-full bg-slate-700 flex-col " id="main-panel-chart">
                
                <div id="centre-fav-container" class="flex justify-end w-full">
                    <input type="hidden" id="current-ticker">
                    <svg id="centre-fav-add" class="hover:fill-slate-200 cursor-pointer m-4" fill="#475569" height="30px" width="30px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 455 455" xml:space="preserve"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <polygon points="455,212.5 242.5,212.5 242.5,0 212.5,0 212.5,212.5 0,212.5 0,242.5 212.5,242.5 212.5,455 242.5,455 242.5,242.5 455,242.5 "></polygon> </g></svg> 
                </div>

                <div class="flex w-full  justify-center">
                    <div id="main-chart" class="w-4/5 h-120 ">
                        <!-- This is where the graph goes -->
                    </div>
                </div>    
                
                <input type="date" class="chartDates border-slate-950 border-solid rounded-md border my-5" placeholder="Date from" id="dateFrom">
                <input type="date" class="chartDates border-slate-950 border-solid rounded-md border my-5" placeholder="Date to" id="dateTo">
                
            </div>
            
                <div id="trade-window" class="w-full h-50 flex my-5">
                    <div class="h-full w-1/2 bg-linear-to-tl/hsl from-slate-900 to-indigo-900 rounded-lg mr-2 ml-4 shadow-xl">
                        <form action="/buy" method="post" class="flex-col">
                            <input class="block border-slate-700 bg-slate-800 rounded-lg py-1 my-2 mx-auto text-center text-slate-100 hover:border-pink-200 focus:border-pink-700 focus:border-solid focus:border" type="text" name="code" id="buy_code" placeholder="Ticker Code">
                            <input class="block border-slate-700 bg-slate-800 rounded-lg py-1 my-2 mx-auto text-center text-slate-100 hover:border-pink-200 focus:border-pink-700 focus:border-solid focus:border" type="text" name="buy_quant" id="buy_quant" placeholder="Quantity">
                            <input class="block rounded-lg border border-white text-white w-28 text-center py-1 my-2 mx-auto hover:from-cyan-500 hover:bg-linear-to-r to-blue-500 hover:border-0 hover:cursor-pointer" type="submit" value="Buy">
                        </form>
                    </div>
                    <div class="h-full w-1/2 bg-linear-to-tr/hsl from-slate-900 to-indigo-900 rounded-lg ml-2 mr-4 shadow-xl">
                        <form action="/sell" method="post" class="flex-col">
                            <input class="block border-slate-700 bg-slate-800 rounded-lg py-1 my-2 mx-auto text-center text-slate-100 hover:border-pink-200 focus:border-pink-700 focus:border-solid focus:border" type="text" name="code" id="sell_code" placeholder="Ticker Code">
                            <input class="block border-slate-700 bg-slate-800 rounded-lg py-1 my-2 mx-auto text-center text-slate-100 hover:border-pink-200 focus:border-pink-700 focus:border-solid focus:border" type="text" name="sell_quant" id="sell_quant" placeholder="Quantity">
                            <input class="block rounded-lg border border-white text-white w-28 text-center py-1 my-2 mx-auto hover:from-cyan-500 hover:bg-linear-to-r to-blue-500 hover:border-0 hover:cursor-pointer" type="submit" value="Sell">
                        </form>
                    </div>
                </div>
                
            
            <div class="w-full justify-center flex px-4" id="data-container">
                <div class="w-1/2 text-slate-200 flex justify-center" id="data-left">
                    <table class="table-fixed">
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Ticker:</td>
                            <td class="table_field" id="ticker"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Data Timestamp:</td>
                            <td class="table_field" id="timestamp"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Last Price:</td>
                            <td class="table_field" id="tngoLast"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Previous Close:</td>
                            <td class="table_field" id="prevClose"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Open Price:</td>
                            <td class="table_field" id="open"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>High:</td>
                            <td class="table_field" id="high"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Low:</td>
                            <td class="table_field" id="low"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Mid:</td>
                            <td class="table_field" id="mid"></td>
                        </tr>
                        <tr class="py-2 border-y border-solid border-slate-500">
                            <td>Volume</td>
                            <td class="table_field" id="volume"></td>
                        </tr>
                    </table>
                </div>
                <div class="w-1/2 text-slate-200" id="data-right">
                    <!-- STOCK INFO META DATA HERE -->
                     <p class="table_field" id="info">Stock meta data</p>
                </div>
            </div>
        </div>
        <div class="w-full h-fit text-slate-50 bg-slate-600 rounded-lg mt-10 mb-5" id="overall-sentiment-panel">
            <p class="font-bold">Overall Market Sentiment:</p>
            <p id="sentiment-label"></p>
            <p id="sentiment-score"></p>
        </div>
        <div class="w-full  h-fit grid grid-cols-2 auto-cols-max gap-5 my-5" id="news_panel">

        </div>

    </div>
    
    <div class=" w-2/8 h-screen text-center flex justify-between" id="right-panel">
        <table class="table-fixed w-1/2">
            <thead>
                <tr class="h-12">
                    <th class="w-4/9">Ticker</th>
                    <th class="w-4/9">Biggest Gain</th>
                    <th class="w-1/9"></th>
                </tr>
            </thead>
            <tbody>

                {% for item in differenceData %}
                    <tr class="border-y border-solid border-collapse border-slate-400 bg-slate-600 hover:bg-slate-700 stock-item">
                        <td class="ticker-code cursor-pointer">
                            {{ item.ticker }}
                        </td>
                        <td>
                            {{ item.difference }}
                        </td>
                        <td>
                            <input type="hidden" name="q" value="{{ item.ticker }}">
                            <form class="fav-form" action="/favourite" method="get">
                                
                                <svg class="hover:fill-slate-200 cursor-pointer add_favourite stock-list-item" fill="#475569" height="20px" width="20px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 455 455" xml:space="preserve"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <polygon points="455,212.5 242.5,212.5 242.5,0 212.5,0 212.5,212.5 0,212.5 0,242.5 212.5,242.5 212.5,455 242.5,455 242.5,242.5 455,242.5 "></polygon> </g></svg> 
                            </form>
                        </td>
                    </tr>
                    
                {% endfor %}
            </tbody>
        </table>
        <table class="table-fixed w-1/2">
            <thead>
                <tr class="h-12">
                    <th class="w-4/9">Ticker</th>
                    <th class="w-4/9">Biggest Loss</th>
                    <th class="w-1/9"></th>
                </tr>
            </thead>
            <tbody>

                {% for item in differenceDataReverse %}
                    <tr class="border-y border-solid border-collapse border-slate-400 bg-slate-600 hover:bg-slate-700 stock-item">
                        <td class="ticker-code cursor-pointer">
                            {{ item.ticker }}
                        </td>
                        <td>
                            {{ item.difference }}
                        </td>
                        <td>
                            <input type="hidden" name="q" value="{{ item.ticker }}">
                            <form class="fav-form" action="/favourite" method="get">
                                
                                <svg class="hover:fill-slate-200 cursor-pointer add_favourite stock-list-item" fill="#475569" height="20px" width="20px" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 455 455" xml:space="preserve"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <polygon points="455,212.5 242.5,212.5 242.5,0 212.5,0 212.5,212.5 0,212.5 0,242.5 212.5,242.5 212.5,455 242.5,455 242.5,242.5 455,242.5 "></polygon> </g></svg> 
                            </form>
                        </td>
                    </tr>
                    
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>

    window.onload = (event) => {
        update_page();
        update_favourites();
    };
</script>


{% endblock %}